<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.crevill.voucher.VoucherMapper">
	
	<select id="selectVoucherCount" parameterType="kr.co.crevill.voucher.VoucherDto" resultType="Integer">
        SELECT COUNT(*)
          FROM VOUCHER
    </select>
	
	<select id="selectVoucherNo" resultType="String">
		SELECT CREATE_COUPON_NO(11,TRUE,FALSE,TRUE,0)
	</select>
	
    <select id="selectVoucherList" parameterType="kr.co.crevill.voucher.VoucherDto" resultType="kr.co.crevill.voucher.VoucherVo">
        SELECT VOUCHER_NO,
			   GRADE,
			   TICKET_NAME,
			   FORMAT(PRICE , 0) PRICE,
			   FORMAT(SALE_PRICE , 0) SALE_PRICE,
			   USE_TIME,
			   CONCAT(END_DATE,'Ïùº') END_DATE,
			   SALE_CODE,
			   REG_ID,
			   DATE_FORMAT(REG_DATE, '%Y-%m-%d') REG_DATE,
			   UPD_ID,
			   DATE_FORMAT(UPD_DATE, '%Y-%m-%d') UPD_DATE,
			   IMAGE_IDX	
          FROM VOUCHER
         LIMIT #{startPage}, #{recordsPerPage}
    </select>
	
	<select id="selectVoucherAttributeList" parameterType="kr.co.crevill.voucher.VoucherDto" resultType="kr.co.crevill.voucher.VoucherVo">
		SELECT VOUCHER_NO,
			   ATTRIBUTE,
			   REG_ID,
			   REG_DATE
          FROM VOUCHER_ATTRIBUTE
         WHERE VOUCHER_NO = #{voucherNo} 
	</select>
	
	<insert id="insertVoucher" parameterType="kr.co.crevill.voucher.VoucherDto">
    	INSERT INTO VOUCHER (
   						     VOUCHER_NO,
						     GRADE,
						     TICKET_NAME,
						     PRICE,
						     SALE_PRICE,
						     USE_TIME,
						     END_DATE,
						     SALE_CODE,
						     REG_ID,
						     REG_DATE,
						     IMAGE_IDX								
   							)
					 VALUES (
							 #{voucherNo},
						     #{grade},
						     #{ticketName},
						     #{price},
						     #{salePrice},
						     #{useTime},
						     #{endDate},
						     #{saleCode},
						     #{regId},
						     NOW(),
						     #{imageIdx}
							)
    </insert>
	
	<insert id="insertVoucherAttribute" parameterType="kr.co.crevill.voucher.VoucherDto">
		INSERT INTO VOUCHER_ATTRIBUTE(
								      VOUCHER_NO,
									  ATTRIBUTE,
									  REG_ID,
									  REG_DATE
									 )
					      	  VALUES (
					      		      #{voucherNo},
								      #{attribute},
								      #{regId},
								      NOW()	
					      		     )			 
	</insert>
	
</mapper>